{
    "enabled": true,
    "name": "Validate Docker Files on Change",
    "description": "Comprehensive Docker validation and security scanning",
    "version": "2.0",
    "when": {
        "type": "fileEdited",
        "patterns": [
            "Dockerfile*",
            "docker-compose*.yml",
            "docker-compose*.yaml",
            "*.dockerfile",
            ".dockerignore"
        ]
    },
    "then": {
        "type": "askAgent",
        "agentName": "devops-infrastructure",
        "prompt": "Docker file modified - run comprehensive validation:\n\n**Validation Steps**:\n1. **Syntax**: `docker build --dry-run` or `docker-compose config`\n2. **Security**: `hadolint Dockerfile` and base image vulnerability scan\n3. **Best practices**: Multi-stage builds, non-root user, specific tags\n4. **Optimization**: Layer caching, .dockerignore efficiency\n\n**Security Checks**:\n- No hardcoded secrets or credentials\n- Minimal attack surface (distroless/alpine base)\n- Proper user permissions and file ownership\n- Health checks and resource limits\n\n**Output**: Validation report with security score and optimization recommendations"
    }
}
